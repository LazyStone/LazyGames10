<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Doodle Justin</title>
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
      font-family: sans-serif;
      background: #87ceeb;
    }

    canvas {
      display: block;
    }

    #startScreen, #gameOverScreen {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      color: white;
      z-index: 10;
    }

    input {
      padding: 10px;
      font-size: 1.2em;
      margin-top: 10px;
    }

    button {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
    }

    #highscores {
      position: absolute;
      top: 10px;
      left: 10px;
      background: white;
      padding: 10px;
      max-width: 200px;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <div id="startScreen">
    <h1>Doodle Justin ðŸ‘µ</h1>
    <p>Gib deinen Namen ein:</p>
    <input type="text" id="playerName" placeholder="Oma Justin..."/>
    <button onclick="startGame()">Spiel starten</button>
  </div>

  <div id="gameOverScreen" style="display:none;">
    <h2>Game Over!</h2>
    <p id="finalScoreText"></p>
    <button onclick="restartGame()">Nochmal spielen</button>
  </div>

  <div id="highscores">
    <h3>Highscores</h3>
    <ul id="scoreList"></ul>
  </div>

  <canvas id="gameCanvas"></canvas>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>

  <script>
    // Firebase Konfiguration
    const firebaseConfig = {
      apiKey: "AIzaSyBFyjjm-Lh3x0ew8_cC_gB24Psy5mkwX5k",
      authDomain: "lazygames-c0a10.firebaseapp.com",
      projectId: "lazygames-c0a10",
      databaseURL: "https://lazygames-c0a10-default-rtdb.europe-west1.firebasedatabase.app",
      storageBucket: "lazygames-c0a10.firebasestorage.app",
      messagingSenderId: "206308085789",
      appId: "1:206308085789:web:39abb186d71586c36a76f4"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    let width = window.innerWidth;
    let height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;

    let player = {
      x: width / 2,
      y: height - 100,
      vy: -10,
      size: 40,
      score: 0,
      isPowered: false,
      powerTime: 0
    };

    let platforms = [];
    let keys = {};
    let gameRunning = false;
    let playerName = "";

    function createPlatform(y) {
      return {
        x: Math.random() * (width - 70),
        y: y,
        width: 70,
        height: 20,
        type: Math.random() < 0.1 ? "power" : "normal"
      };
    }

    function resetPlatforms() {
      platforms = [];
      for (let i = 0; i < 15; i++) {
        platforms.push(createPlatform(height - i * 100));
      }
    }

    function drawPlayer() {
      ctx.fillStyle = "pink";
      ctx.beginPath();
      ctx.arc(player.x, player.y, player.size / 2, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = "black";
      ctx.font = "bold 14px sans-serif";
      ctx.fillText("ðŸ‘µ", player.x - 10, player.y + 5);
    }

    function drawPlatforms() {
      platforms.forEach(p => {
        ctx.fillStyle = p.type === "power" ? "gold" : "white";
        ctx.fillRect(p.x, p.y, p.width, p.height);
      });
    }

    function update() {
      player.vy += 0.5;
      player.y += player.vy;

      if (keys["ArrowLeft"]) player.x -= 5;
      if (keys["ArrowRight"]) player.x += 5;

      if (player.x < 0) player.x = width;
      if (player.x > width) player.x = 0;

      platforms.forEach(p => {
        if (player.vy > 0 && player.x > p.x && player.x < p.x + p.width &&
            player.y + player.size / 2 > p.y && player.y + player.size / 2 < p.y + p.height) {
          if (p.type === "power") {
            player.vy = -20;
            player.isPowered = true;
            player.powerTime = Date.now();
          } else {
            player.vy = -15;
          }
        }
      });

      if (player.y < height / 2) {
        let dy = height / 2 - player.y;
        player.y = height / 2;
        player.score += Math.floor(dy);
        platforms.forEach(p => p.y += dy);
        while (platforms.length < 15) {
          platforms.push(createPlatform(platforms[platforms.length - 1].y - 100));
        }
        platforms = platforms.filter(p => p.y < height);
      }

      if (player.y > height) {
        endGame();
      }

      if (player.isPowered && Date.now() - player.powerTime > 5000) {
        player.isPowered = false;
      }
    }

    function drawBackground() {
      let level = player.score;
      if (level < 1000) {
        ctx.fillStyle = "#a0522d"; // Scheune
      } else if (level < 3000) {
        ctx.fillStyle = "#87ceeb"; // Himmel
      } else {
        ctx.fillStyle = "#000"; // Weltraum
      }
      ctx.fillRect(0, 0, width, height);
    }

    function gameLoop() {
      if (!gameRunning) return;
      ctx.clearRect(0, 0, width, height);
      drawBackground();
      drawPlatforms();
      drawPlayer();
      update();
      requestAnimationFrame(gameLoop);
    }

    function startGame() {
      playerName = document.getElementById("playerName").value.trim();
      if (!playerName) return alert("Bitte Namen eingeben!");

      document.getElementById("startScreen").style.display = "none";
      resetPlatforms();
      player.y = height - 100;
      player.vy = -10;
      player.score = 0;
      gameRunning = true;
      gameLoop();
    }

    function endGame() {
      gameRunning = false;
      document.getElementById("gameOverScreen").style.display = "flex";
      document.getElementById("finalScoreText").innerText = `${playerName}, dein Score: ${player.score} Meter`;

      const newEntry = {
        name: playerName,
        score: player.score
      };

      const newRef = db.ref("highscores").push();
      newRef.set(newEntry);
    }

    function restartGame() {
      document.getElementById("gameOverScreen").style.display = "none";
      startGame();
    }

    function loadHighscores() {
      const list = document.getElementById("scoreList");
      db.ref("highscores").orderByChild("score").limitToLast(5).on("value", snapshot => {
        list.innerHTML = "";
        const scores = [];
        snapshot.forEach(child => {
          scores.push(child.val());
        });
        scores.reverse().forEach(entry => {
          const li = document.createElement("li");
          li.textContent = `${entry.name}: ${entry.score} m`;
          list.appendChild(li);
        });
      });
    }

    window.addEventListener("keydown", e => keys[e.key] = true);
    window.addEventListener("keyup", e => keys[e.key] = false);
    loadHighscores();
  </script>
</body>
</html>
